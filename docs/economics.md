# Экономика облачного сервиса

в качестве приложения решил взять мое тестовое задание для стажировки в ВК которое писал летом  
[https://github.com/Babushkin05/simple-marketplace](https://github.com/Babushkin05/simple-marketplace)

## краткое описание программы

Simple Marketplace — это микросервисное приложение, реализующее упрощённую платформу объявлений.

Приложение позволяет:
- регистрироваться и авторизовываться
- создавать объявления
- получать список объявлений с фильтрами и сортировкой

Архитектура микросервисная и состоит из следующих компонентов:
- API Gateway — принимает HTTP-запросы, отдает Swagger, проксирует запросы в сервисы
- Auth Service — регистрация, логин, выдача и проверка JWT токенов
- Goods Service — создание и получение объявлений
- PostgreSQL — хранение данных сервисов

Взаимодействие сервисов происходит по gRPC. Все сервисы запускаются в Docker-контейнерах.

---

## требования к нагрузке

При расчёте инфраструктуры я закладываюсь на:
- до 100 запросов в секунду
- среднюю задержку ответа около 50 мс
- отказоустойчивость при падении одного дата-центра

---

## выбор облака

Для деплоя выбран **Yandex Cloud**, потому что:
- это современное облако с хорошей документацией
- поддерживается размещение ресурсов в нескольких ЦОД
- есть управляемые базы данных
- упрощается эксплуатация и резервное копирование

Используемые зоны доступности:
- ru-central1-a
- ru-central1-b
- ru-central1-d

---

## схема размещения сервисов

В приложении используется 3 микросервиса:
- API Gateway
- Auth Service
- Goods Service

Для каждого сервиса запускается по **3 инстанса**, каждый в своей зоне доступности:
- ru-central1-a
- ru-central1-b
- ru-central1-d

Общее количество виртуальных машин:
- 3 сервиса × 3 инстанса = **9 VM**

---

## расчет ресурсов для микросервисов

Для каждого инстанса микросервиса используется следующая конфигурация:
- 2 vCPU
- 4 ГБ RAM

Такая конфигурация позволяет стабильно обрабатывать до 100 RPS с задержкой около 50 мс.

---

## расчет стоимости виртуальных машин

Примем следующие цены в Yandex Cloud:
- 1 vCPU — **620 ₽ / месяц**
- 1 ГБ RAM — **180 ₽ / месяц**

Стоимость одной VM:
- CPU: 2 × 620 ₽ = **1 240 ₽**
- RAM: 4 × 180 ₽ = **720 ₽**

Итого одна VM:
- 1 240 ₽ + 720 ₽ = **1 960 ₽ / месяц**

Стоимость всех VM:
- 9 VM × 1 960 ₽ = **17 640 ₽ / месяц**

---

## базы данных

В проекте у каждого микросервиса используется **своя изолированная база данных**.  
Для этого разворачиваются отдельные экземпляры **Managed PostgreSQL**.

Всего баз данных:
- Auth Service — 1 БД
- Goods Service — 1 БД

Итого: **3 отдельные базы данных**

---

## расчет стоимости одной базы данных

Конфигурация одной базы данных:
- 2 vCPU
- 4 ГБ RAM
- 20 ГБ SSD
- отказоустойчивая конфигурация

Примем цены:
- 1 vCPU — **620 ₽ / месяц**
- 1 ГБ RAM — **180 ₽ / месяц**
- 1 ГБ SSD — **14 ₽ / месяц**

Расчет одной БД:
- CPU: 2 × 620 ₽ = **1 240 ₽**
- RAM: 4 × 180 ₽ = **720 ₽**
- SSD: 20 × 14 ₽ = **280 ₽**

Стоимость одной БД:
- 1 240 ₽ + 720 ₽ + 280 ₽ = **2 240 ₽ / месяц**

---

## расчет стоимости всех баз данных

- 2 БД × 2 240 ₽ = **4 480 ₽ / месяц**

---

## сеть и балансировка

Для доступа пользователей используется HTTP load balancer и сетевой трафик.

Примем следующие цены:
- Load balancer — **410 ₽ / месяц**
- Исходящий трафик — **275 ₽ / месяц**

Стоимость сети:
- 410 ₽ + 275 ₽ = **685 ₽ / месяц**

---

## итоговый расчет стоимости

Складываем все расходы:

- виртуальные машины: **17 640 ₽**
- managed PostgreSQL (3 БД): **6 720 ₽**
- сеть и балансировка: **685 ₽**

Итоговая стоимость:
- 17 640 ₽ + 4480 ₽ + 685 ₽ = **22 805 ₽ / месяц**

---

## вывод

При стоимости **22 905 ₽ в месяц** данная инфраструктура позволяет:
- обеспечить отказоустойчивость за счёт размещения сервисов в разных ЦОД
- выдерживать нагрузку до 100 запросов в секунду
- поддерживать целевую задержку около 50 мс
- изолировать данные микросервисов
- снизить операционные затраты за счёт управляемых сервисов

Yandex Cloud подходит для деплоя данного проекта благодаря отказоустойчивой архитектуре, наличию нескольких зон доступности и прозрачному ценообразованию.


---
P.S на самом деле я его хосчу на [https://simple-marketplace.babushkin05.ru/swagger/index.html#/](https://simple-marketplace.babushkin05.ru/swagger/index.html#/) на сервере который собрал за 5к в прошлом году), возможно когда вы проверяете он упал)